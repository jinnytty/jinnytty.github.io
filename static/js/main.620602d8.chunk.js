(this["webpackJsonpchat-test"]=this["webpackJsonpchat-test"]||[]).push([[0],{84:function(e,t,s){},85:function(e,t,s){},86:function(e,t,s){"use strict";s.r(t);var i=s(8),r=s(0),n=s.n(r),a=s(30),h=s.n(a),o=s(31),c=s.n(o),u=s(32),f=s(40),d=s(1),l=s.n(d),m=s(6),v=s(3),g=s(4),p=s(41),b=s(39);var x=s(33),k=s.n(x),y=s(11),j=s.n(y),q=k()("BaseSource"),w=function(){function e(){Object(v.a)(this,e),this.offset=0,this.resetError=!1,this.threshold=20,this.backTime=2,this.cacheTime=60,this.index=0,this.messages=[],this.requestPromise=null,this.listeners=[],this.doUpdateFn=j.a.fn(this.doUpdate.bind(this)),this.doRequestFn=j.a.fn(this.doRequest.bind(this))}return Object(g.a)(e,[{key:"request",value:function(e){var t=this;q("request(%d)",e),this.resetError=!1;var s=e-this.backTime;return s<0&&(s=0),this.offset=e,0===this.messages.length||e<this.messages[0].offset||e>this.messages[this.messages.length-1].offset?(q("offset out of boundary: new request"),null!=this.requestPromise&&(q("cancel ongoing request"),this.requestPromise.cancel()),this.index=0,this.messages=[],this.emitClear(),this.requestPromise=this.doRequestFn(s),this.requestPromise.then(this.addMessages.bind(this)).catch((function(e){e instanceof j.a.CancelError||t.reset()})),this):(e<this.messages[this.index].offset&&(q("reset index"),this.index=0),this.release(),this.removeOld(),this.triggerUpdate(),this)}},{key:"update",value:function(e){if(q("update(%d)",e),this.resetError)return this;if(e<this.offset){if(!(e<this.offset-1.5))return this;this.index=0,this.emitClear()}return this.offset=e,this.release(),this.removeOld(),this.triggerUpdate(),this}},{key:"reset",value:function(){var e=this;q("reset()"),this.index=0,this.messages=[];var t=this.offset-this.backTime;t<0&&(t=0),this.emitClear(),this.requestPromise=this.doRequestFn(t),this.requestPromise.then(this.addMessages.bind(this)).catch((function(t){t instanceof j.a.CancelError||(e.resetError=!0,e.emitError("unable to reset chat"))}))}},{key:"removeOld",value:function(){q("removeOld()");var e=-1,t=this.offset-this.backTime;q("time %d",t);for(var s=0;s<this.messages.length;++s){if(this.messages[s].offset>=t){q("last index %d",e=s-1);break}s===this.messages.length-1&&(q("delete all"),e=s)}e>-1&&(q("remove message from 0 to %d",e),this.messages.splice(0,e+1),this.index-=e+1),q("new index %d",this.index)}},{key:"release",value:function(){q("release()");var e=[];q("index %d",this.index);for(var t=this.index+1;t<this.messages.length;++t){var s=this.messages[t];if(s.offset>this.offset)break;this.index=t,e.push(s)}q("new index %d",this.index),q("emit %d",e.length),this.emitMessages(e)}},{key:"triggerUpdate",value:function(){var e=this;if(q("triggerupdate()"),!this.resetError)if(null==this.requestPromise){if(this.messages.length>0){var t=this.messages[this.index];if(q("index message offset %d <= %d",t.offset,this.threshold),t.offset<=this.threshold)return}this.requestPromise=this.doUpdateFn(),this.requestPromise.then(this.addMessages.bind(this)).catch((function(t){q("triggerUpdate request fail %s",t.toString()),t instanceof j.a.CancelError||e.reset()}))}else q("requestPromise != null")}},{key:"addMessages",value:function(e){if(q("addMesssage(%d)",e.length),this.requestPromise=null,this.messages=this.messages.concat(e),e.length>0){var t=e[0].offset,s=e[e.length-1].offset;if(q("offset %d start %d end %d",this.offset,t,s),this.offset>s)return q("offset > endoffset -> reset"),void this.reset();this.threshold=t+Math.round((s-t)/2),q("set threshold %d",this.threshold)}this.release(),this.removeOld(),this.triggerUpdate()}},{key:"addListener",value:function(e){return this.listeners.push(e),this}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);return t>-1&&this.listeners.splice(t,1),this}},{key:"emitError",value:function(e){this.listeners.forEach((function(t){return t.error(e)}))}},{key:"emitMessages",value:function(e){this.listeners.forEach((function(t){return t.message(e)}))}},{key:"emitClear",value:function(){this.listeners.forEach((function(e){return e.clear()}))}}]),e}();var O=s(34),E=s.n(O),P=s(35),M=s.n(P)()("TwitchVod"),U=function(e){Object(p.a)(s,e);var t=Object(b.a)(s);function s(e){var i;return Object(v.a)(this,s),(i=t.call(this)).cursor="",i.options=e,i}return Object(g.a)(s,[{key:"doRequest",value:function(e){return M("request %d",e),this.cursor="",this.callApi(e)}},{key:"doUpdate",value:function(){return M("update %s",this.cursor),this.callApi(null)}},{key:"callApi",value:function(){var e=Object(m.a)(l.a.mark((function e(t){var s,i,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return M("callapi %d",t),s="https://api.twitch.tv/v5/videos/".concat(this.options.vodid,"/comments?"),null!=t?s=s+"content_offset_seconds="+t:(M("use cursor"),s+="cursor=".concat(this.cursor)),e.next=5,this.fetch(s);case 5:if(i=e.sent){e.next=8;break}return e.abrupt("return",[]);case 8:return this.cursor=i._next,r=i.comments.map((function(e){return{offset:e.content_offset_seconds,data:e}})),e.abrupt("return",r);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetch",value:function(){var e=Object(m.a)(l.a.mark((function e(t){var s,i,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:M("fetch %s",t),s=0;case 2:if(!(s<3)){e.next=21;break}return e.prev=3,e.next=6,E()(t,{headers:{Accept:"application/vnd.twitchtv.v5+json","Client-ID":this.options.clientId}});case 6:if(200==(i=e.sent).status){e.next=9;break}throw new Error("invalid status code");case 9:return e.next=11,i.json();case 11:return r=e.sent,e.abrupt("return",r);case 15:e.prev=15,e.t0=e.catch(3),console.error("unable to get comments "+e.t0.toString());case 18:++s,e.next=2;break;case 21:throw this.emitError("unable to get messages"),new Error("unable to get comments");case 23:case"end":return e.stop()}}),e,this,[[3,15]])})));return function(t){return e.apply(this,arguments)}}()}]),s}(w),C=s(36),_=s(37),R=s(38);s(84);var F=function(){var e="n0dkyk9hwq7lzc7knflzssp6v9fsbv",t=new U({clientId:e,vodid:"1155849029"}),s=new C.a(t),a=n.a.useRef();Object(r.useEffect)((function(){f.a.create("jinnytty",e,_.a.create,R.a.create).then((function(e){new u.a(a.current,t,e)})),s.setPlayer(h.current)}));var h=n.a.useRef();return Object(i.jsxs)(n.a.Fragment,{children:[Object(i.jsx)("div",{id:"player",children:Object(i.jsx)(c.a,{ref:h,url:"https://api.pogu.live/https://d2nvs31859zcd8.cloudfront.net/4475570031b5be958ef9_jinnytty_39998838683_1632302793/chunked/index-dvr.m3u8",controls:"true",width:"100%",height:"100%",onPlay:s.onPlay.bind(s),onPause:s.onPause.bind(s)})}),Object(i.jsx)("div",{id:"chat",ref:a})]})};s(85),h.a.render(Object(i.jsx)(n.a.StrictMode,{children:Object(i.jsx)(F,{})}),document.getElementById("root"))}},[[86,1,2]]]);
//# sourceMappingURL=main.620602d8.chunk.js.map